<?xml version="1.0" encoding="UTF-8"?>
<templates xml:space="preserve">

    <t t-name="fleet_inspection_mobile.InspectionMobile" owl="1">
        <div class="o_fleet_inspection_mobile">
            <div class="inspection-mobile-container">
                <div class="inspection-header bg-primary text-white p-3">
                    <h3 class="mb-0">
                        <i class="fa fa-clipboard-check me-2"/>
                        Inspección Vehicular
                    </h3>
                </div>

                <div class="inspection-body p-4">
                    <t t-if="state.loading">
                        <div class="text-center py-5">
                            <i class="fa fa-spinner fa-spin fa-3x text-primary"/>
                            <p class="mt-3">Cargando...</p>
                        </div>
                    </t>
                    
                    <t t-elif="state.selectingVehicle">
                        <div class="container-fluid">
                            <div class="row">
                                <div class="col-12">
                                    <h4 class="mb-3">Seleccionar Vehículo</h4>
                                    <button class="btn btn-secondary mb-3" t-on-click="onCancelVehicleSelection">
                                        <i class="fa fa-arrow-left me-2"/>
                                        Volver
                                    </button>
                                </div>
                            </div>
                            <div class="row">
                                <t t-foreach="state.vehicles" t-as="vehicle" t-key="vehicle.id">
                                    <div class="col-12 col-md-6 col-lg-4 mb-3">
                                        <div class="card h-100" style="cursor: pointer;" t-on-click="(ev) => this.onSelectVehicle(vehicle.id)">
                                            <div class="card-body">
                                                <h5 class="card-title">
                                                    <i class="fa fa-car me-2"/>
                                                    <t t-esc="vehicle.license_plate"/>
                                                </h5>
                                                <p class="card-text">
                                                    <t t-esc="vehicle.name"/>
                                                </p>
                                                <t t-if="vehicle.driver_id">
                                                    <small class="text-muted">
                                                        Conductor: <t t-esc="vehicle.driver_id[1]"/>
                                                    </small>
                                                </t>
                                            </div>
                                        </div>
                                    </div>
                                </t>
                                <t t-if="!state.vehicles or state.vehicles.length === 0">
                                    <div class="col-12">
                                        <div class="alert alert-warning">
                                            No hay vehículos disponibles
                                        </div>
                                    </div>
                                </t>
                            </div>
                        </div>
                    </t>
                    <t t-elif="state.showingObservations">
                        <!-- Observations Input -->
                        <div class="container-fluid h-100 d-flex flex-column">
                            <!-- Header -->
                            <div class="row bg-warning text-dark border-bottom py-2 mb-3 flex-shrink-0">
                                <div class="col-12">
                                    <h6 class="mb-1">
                                        <i class="fa fa-comment me-2"/>
                                        Observaciones - <t t-esc="state.selectedStatus === 'regular' ? 'Regular' : 'Mal'"/>
                                    </h6>
                                    <small class="text-muted">
                                        <t t-esc="state.currentItem.name"/>
                                    </small>
                                </div>
                            </div>
                            
                            <!-- Observations Input -->
                            <div class="row flex-grow-1">
                                <div class="col-12">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <p class="mb-3">
                                                Describe el problema encontrado:
                                            </p>
                                            <textarea class="form-control" rows="5" 
                                                      t-model="state.observations"
                                                      placeholder="Escriba aquí las observaciones (opcional)..."/>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Actions -->
                            <div class="row mt-3 flex-shrink-0">
                                <div class="col-6">
                                    <button class="btn btn-outline-secondary btn-block w-100" 
                                            t-on-click="this.onSkipObservations">
                                        <i class="fa fa-forward me-2"/>
                                        Omitir
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button class="btn btn-primary btn-block w-100" 
                                            t-on-click="this.onSaveObservations">
                                        <i class="fa fa-save me-2"/>
                                        Guardar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </t>
                    <t t-elif="state.showingDraftSelection">
                        <!-- Draft Inspections Selection Screen -->
                        <div class="container-fluid h-100 d-flex flex-column">
                            <!-- Header -->
                            <div class="row bg-warning text-dark border-bottom py-2 mb-3 flex-shrink-0">
                                <div class="col-12">
                                    <h6 class="mb-1">
                                        <i class="fa fa-clock-o me-2"/>
                                        Inspecciones Pendientes
                                    </h6>
                                    <small>
                                        Selecciona una inspección para continuar
                                    </small>
                                </div>
                            </div>
                            
                            <!-- Draft Inspections List -->
                            <div class="row flex-grow-1">
                                <div class="col-12">
                                    <div class="list-group">
                                        <t t-foreach="state.draftInspections" t-as="inspection" t-key="inspection.id">
                                            <button class="list-group-item list-group-item-action" 
                                                    t-on-click="() => this.resumeInspection(inspection.id)">
                                                <div class="d-flex justify-content-between align-items-center">
                                                    <div>
                                                        <h6 class="mb-1">
                                                            <i class="fa fa-car me-2"/>
                                                            <t t-esc="inspection.vehicle_id[1]"/>
                                                        </h6>
                                                        <p class="mb-1 text-muted">
                                                            <t t-esc="inspection.name"/>
                                                        </p>
                                                        <small class="text-muted">
                                                            <t t-esc="inspection.inspection_date"/>
                                                        </small>
                                                    </div>
                                                    <div class="text-end">
                                                        <span class="badge bg-warning">
                                                            <t t-esc="Math.round(inspection.completion_percentage || 0)"/>% completado
                                                        </span>
                                                    </div>
                                                </div>
                                            </button>
                                        </t>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Actions -->
                            <div class="row mt-3 flex-shrink-0">
                                <div class="col-12">
                                    <button class="btn btn-outline-secondary btn-block w-100" 
                                            t-on-click="() => { this.state.showingDraftSelection = false; }">
                                        <i class="fa fa-arrow-left me-2"/>
                                        Volver
                                    </button>
                                </div>
                            </div>
                        </div>
                    </t>
                    <t t-elif="state.showingDriverInfo">
                        <!-- Driver Information Screen -->
                        <div class="container-fluid h-100 d-flex flex-column">
                            <!-- Header -->
                            <div class="row bg-info text-white border-bottom py-2 mb-3 flex-shrink-0">
                                <div class="col-12">
                                    <h6 class="mb-1">
                                        <i class="fa fa-id-card me-2"/>
                                        Información del Conductor
                                    </h6>
                                    <small>
                                        Complete los datos del conductor antes de comenzar
                                    </small>
                                </div>
                            </div>
                            
                            <!-- Driver Information Form -->
                            <div class="row flex-grow-1">
                                <div class="col-12">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <form>
                                                <div class="mb-3">
                                                    <label class="form-label"><strong>Número de Licencia *</strong></label>
                                                    <input type="text" 
                                                           class="form-control form-control-lg" 
                                                           t-model="state.driverInfo.license_number"
                                                           placeholder="Ej: 12345678"
                                                           required="required"/>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label class="form-label"><strong>Tipo de Licencia *</strong></label>
                                                    <select class="form-control form-control-lg" t-model="state.driverInfo.license_type" required="required">
                                                        <option value="">Seleccione tipo</option>
                                                        <option value="A">A - Motocicletas</option>
                                                        <option value="B">B - Automóviles</option>
                                                        <option value="C">C - Camiones</option>
                                                        <option value="D">D - Transporte de pasajeros</option>
                                                        <option value="E">E - Articulados</option>
                                                    </select>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label class="form-label">Vencimiento de Licencia</label>
                                                    <input type="date" 
                                                           class="form-control form-control-lg" 
                                                           t-model="state.driverInfo.license_expiry"/>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <label class="form-label"><strong>Odómetro (km)</strong></label>
                                                    <input type="number" 
                                                           class="form-control form-control-lg" 
                                                           t-model="state.driverInfo.odometer"
                                                           placeholder="Ej: 150000"
                                                           step="1"
                                                           min="0"/>
                                                </div>
                                                
                                                <div class="mb-3">
                                                    <div class="form-check">
                                                        <input type="checkbox" 
                                                               class="form-check-input" 
                                                               id="defensiveCourse"
                                                               t-model="state.driverInfo.defensive_course"/>
                                                        <label class="form-check-label" for="defensiveCourse">
                                                            <strong>¿Curso de manejo defensivo?</strong>
                                                        </label>
                                                    </div>
                                                </div>
                                                
                                                <div t-if="state.driverInfo.defensive_course">
                                                    <div class="mb-3">
                                                        <label class="form-label"><strong>Vencimiento del Curso</strong></label>
                                                        <input type="date" 
                                                               class="form-control form-control-lg" 
                                                               t-model="state.driverInfo.course_expiry"/>
                                                    </div>
                                                    
                                                    <div class="mb-3">
                                                        <label class="form-label"><strong>Duración del Curso</strong></label>
                                                        <input type="text" 
                                                               class="form-control form-control-lg" 
                                                               t-model="state.driverInfo.course_duration"
                                                               placeholder="Ej: 8 horas, 2 días"/>
                                                    </div>
                                                </div>
                                            </form>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Actions -->
                            <div class="row mt-3 flex-shrink-0">
                                <div class="col-6">
                                    <button class="btn btn-outline-secondary btn-block w-100" 
                                            t-on-click="this.onSkipDriverInfo">
                                        <i class="fa fa-forward me-2"/>
                                        Omitir
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button class="btn btn-primary btn-block w-100" 
                                            t-on-click="this.onSaveDriverInfo">
                                        <i class="fa fa-arrow-right me-2"/>
                                        Continuar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </t>
                    <t t-elif="state.showingPhotoCapture">
                        <!-- Photo Capture Screen -->
                        <div class="container-fluid h-100 d-flex flex-column">
                            <!-- Header -->
                            <div class="row bg-danger text-white border-bottom py-2 mb-3 flex-shrink-0">
                                <div class="col-12">
                                    <h6 class="mb-1">
                                        <i class="fa fa-camera me-2"/>
                                        Capturar Fotos - Elemento Mal
                                    </h6>
                                    <small>
                                        <t t-esc="state.currentItem.name"/>
                                    </small>
                                </div>
                            </div>
                            
                            <!-- Photo Capture Area -->
                            <div class="row flex-grow-1">
                                <div class="col-12">
                                    <div class="card h-100">
                                        <div class="card-body">
                                            <p class="mb-3 text-danger">
                                                <strong>Se requiere foto para elementos marcados como 'Mal'</strong>
                                            </p>
                                            
                                            <!-- Camera/File Input -->
                                            <div class="mb-4">
                                                <div class="d-grid gap-2">
                                                    <!-- Direct Camera Capture (Mobile) -->
                                                    <label class="btn btn-primary btn-lg">
                                                        <i class="fa fa-camera me-2"/>
                                                        Tomar Foto con Cámara
                                                        <input type="file" 
                                                               accept="image/*" 
                                                               capture="camera"
                                                               style="display: none;"
                                                               t-on-change="this.onCapturePhoto"/>
                                                    </label>
                                                    
                                                    <!-- File Selection (Gallery) -->
                                                    <label class="btn btn-outline-primary btn-lg">
                                                        <i class="fa fa-image me-2"/>
                                                        Seleccionar de Galería
                                                        <input type="file" 
                                                               accept="image/*" 
                                                               multiple="multiple"
                                                               style="display: none;"
                                                               t-on-change="this.onCapturePhoto"/>
                                                    </label>
                                                </div>
                                            </div>
                                            
                                            <!-- Preview of captured photos -->
                                            <t t-if="state.capturedPhotos.length > 0">
                                                <h6>Fotos capturadas (<t t-esc="state.capturedPhotos.length"/>):</h6>
                                                <div class="row">
                                                    <t t-foreach="state.capturedPhotos" t-as="photo" t-key="photo_index">
                                                        <div class="col-6 col-md-4 mb-3">
                                                            <div class="position-relative">
                                                                <img t-att-src="photo.preview" 
                                                                     class="img-thumbnail w-100" 
                                                                     style="height: 150px; object-fit: cover;"/>
                                                                <button class="btn btn-sm btn-danger position-absolute top-0 end-0 m-1"
                                                                        t-on-click="() => this.onRemovePhoto(photo_index)">
                                                                    <i class="fa fa-times"/>
                                                                </button>
                                                            </div>
                                                        </div>
                                                    </t>
                                                </div>
                                            </t>
                                            
                                            <t t-else="">
                                                <div class="alert alert-warning">
                                                    No hay fotos capturadas. Tome al menos una foto del problema.
                                                </div>
                                            </t>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Actions -->
                            <div class="row mt-3 flex-shrink-0">
                                <div class="col-6">
                                    <button class="btn btn-outline-secondary btn-block w-100" 
                                            t-on-click="this.onSkipPhotos"
                                            t-att-disabled="state.photoRequired">
                                        <i class="fa fa-forward me-2"/>
                                        <t t-if="state.photoRequired">No Permitido</t>
                                        <t t-else="">Omitir</t>
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button class="btn btn-success btn-block w-100" 
                                            t-on-click="this.onSavePhotos"
                                            t-att-disabled="state.capturedPhotos.length === 0">
                                        <i class="fa fa-check me-2"/>
                                        Guardar y Continuar
                                    </button>
                                </div>
                            </div>
                        </div>
                    </t>
                    <t t-elif="state.inspectionStarted">
                        <!-- Mobile Inspection Interface -->
                        <div class="container-fluid h-100 d-flex flex-column">
                            <!-- Vehicle Info Header -->
                            <div class="row bg-light border-bottom py-2 mb-3 flex-shrink-0">
                                <div class="col-12">
                                    <h6 class="mb-1">
                                        <i class="fa fa-car me-2"/>
                                        <t t-esc="state.vehicleInfo.name"/>
                                    </h6>
                                    <small class="text-muted">
                                        Conductor: <t t-esc="state.vehicleInfo.driver"/>
                                    </small>
                                    <!-- Visual Progress Indicator -->
                                    <div class="mt-2">
                                        <div class="d-flex justify-content-between align-items-center mb-1">
                                            <span class="small">Progreso de Inspección</span>
                                            <span class="badge bg-primary">
                                                <t t-esc="state.items.filter(item => item.status).length"/>/<t t-esc="state.items.length"/> completados
                                            </span>
                                        </div>
                                        <div class="progress" style="height: 8px;">
                                            <div class="progress-bar bg-success" 
                                                 t-att-style="'width: ' + ((state.items.filter(item => item.status === 'bien').length / state.items.length) * 100) + '%'"
                                                 t-att-title="state.items.filter(item => item.status === 'bien').length + ' elementos buenos'"></div>
                                            <div class="progress-bar bg-warning" 
                                                 t-att-style="'width: ' + ((state.items.filter(item => item.status === 'regular').length / state.items.length) * 100) + '%'"
                                                 t-att-title="state.items.filter(item => item.status === 'regular').length + ' elementos regulares'"></div>
                                            <div class="progress-bar bg-danger" 
                                                 t-att-style="'width: ' + ((state.items.filter(item => item.status === 'mal').length / state.items.length) * 100) + '%'"
                                                 t-att-title="state.items.filter(item => item.status === 'mal').length + ' elementos malos'"></div>
                                            <div class="progress-bar bg-secondary" 
                                                 t-att-style="'width: ' + ((state.items.filter(item => item.status === 'na').length / state.items.length) * 100) + '%'"
                                                 t-att-title="state.items.filter(item => item.status === 'na').length + ' elementos N/A'"></div>
                                        </div>
                                        <div class="d-flex justify-content-between mt-1">
                                            <small class="text-success">
                                                <i class="fa fa-check"/> <t t-esc="state.items.filter(item => item.status === 'bien').length"/>
                                            </small>
                                            <small class="text-warning">
                                                <i class="fa fa-exclamation-triangle"/> <t t-esc="state.items.filter(item => item.status === 'regular').length"/>
                                            </small>
                                            <small class="text-danger">
                                                <i class="fa fa-times"/> <t t-esc="state.items.filter(item => item.status === 'mal').length"/>
                                            </small>
                                            <small class="text-muted">
                                                <i class="fa fa-minus"/> <t t-esc="state.items.filter(item => item.status === 'na').length"/>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Current Item -->
                            <div class="row flex-grow-1">
                                <div class="col-12">
                                    <t t-if="state.currentItem">
                                        <div class="card h-100">
                                            <div class="card-header">
                                                <div class="d-flex justify-content-between align-items-start">
                                                    <div>
                                                        <h5 class="mb-1">
                                                            <t t-if="state.currentItem.status">
                                                                <span t-att-class="'badge me-2 ' + (state.currentItem.status === 'bien' ? 'bg-success' : state.currentItem.status === 'regular' ? 'bg-warning text-dark' : state.currentItem.status === 'mal' ? 'bg-danger' : 'bg-secondary')">
                                                                    <i t-att-class="'fa ' + (state.currentItem.status === 'bien' ? 'fa-check' : state.currentItem.status === 'regular' ? 'fa-exclamation-triangle' : state.currentItem.status === 'mal' ? 'fa-times' : 'fa-minus')"/>
                                                                    <t t-esc="state.currentItem.status === 'bien' ? 'BIEN' : state.currentItem.status === 'regular' ? 'REGULAR' : state.currentItem.status === 'mal' ? 'MAL' : 'N/A'"/>
                                                                </span>
                                                            </t>
                                                            <t t-else="">
                                                                <span class="badge bg-light text-dark me-2">PENDIENTE</span>
                                                            </t>
                                                            <t t-esc="state.currentItem.name"/>
                                                        </h5>
                                                        <small class="text-muted">
                                                            Item <t t-esc="state.itemIndex + 1"/> de <t t-esc="state.items.length"/>
                                                            <t t-if="state.currentItem.section"> - <t t-esc="state.currentItem.section"/></t>
                                                        </small>
                                                    </div>
                                                </div>
                                                <t t-if="state.currentItem.observations">
                                                    <div class="mt-2 p-2 bg-light border rounded">
                                                        <small class="text-muted d-block mb-1">
                                                            <i class="fa fa-comment me-1"/> Observaciones previas:
                                                        </small>
                                                        <small class="text-dark">
                                                            <t t-esc="state.currentItem.observations"/>
                                                        </small>
                                                    </div>
                                                </t>
                                            </div>
                                            <div class="card-body text-center">
                                                <t t-if="state.currentItem.description">
                                                    <p class="text-muted mb-4">
                                                        <t t-esc="state.currentItem.description"/>
                                                    </p>
                                                </t>

                                                <t t-if="state.currentItem.instructions and state.currentItem.instructions !== 'false'">
                                                    <div class="alert alert-info text-start mb-4">
                                                        <strong><i class="fa fa-info-circle me-2"/>Instrucciones:</strong>
                                                        <p class="mb-0 mt-2" style="white-space: pre-line;"><t t-esc="state.currentItem.instructions"/></p>
                                                    </div>
                                                </t>

                                                <t t-if="state.currentItem.tips and state.currentItem.tips !== 'false'">
                                                    <div class="alert alert-warning text-start mb-4">
                                                        <strong><i class="fa fa-lightbulb-o me-2"/>Consejos:</strong>
                                                        <p class="mb-0 mt-2" style="white-space: pre-line;"><t t-esc="state.currentItem.tips"/></p>
                                                    </div>
                                                </t>

                                                <!-- Status Buttons -->
                                                <div class="d-grid gap-2 mb-4">
                                                    <button t-att-class="state.currentItem.status === 'bien' ? 'btn btn-success btn-lg fw-bold border-3 border-dark' : 'btn btn-outline-success btn-lg'" 
                                                            t-on-click="() => this.onSelectStatus('bien')">
                                                        <i t-att-class="state.currentItem.status === 'bien' ? 'fa fa-check-circle me-2' : 'fa fa-check me-2'"/>
                                                        <span t-if="state.currentItem.status === 'bien'">✓ SELECCIONADO - </span>Bien
                                                    </button>
                                                    <button t-att-class="state.currentItem.status === 'regular' ? 'btn btn-warning btn-lg fw-bold border-3 border-dark text-dark' : 'btn btn-outline-warning btn-lg'"
                                                            t-on-click="() => this.onSelectStatus('regular')">
                                                        <i t-att-class="state.currentItem.status === 'regular' ? 'fa fa-exclamation-circle me-2' : 'fa fa-exclamation-triangle me-2'"/>
                                                        <span t-if="state.currentItem.status === 'regular'">✓ SELECCIONADO - </span>Regular
                                                    </button>
                                                    <button t-att-class="state.currentItem.status === 'mal' ? 'btn btn-danger btn-lg fw-bold border-3 border-dark' : 'btn btn-outline-danger btn-lg'"
                                                            t-on-click="() => this.onSelectStatus('mal')">
                                                        <i t-att-class="state.currentItem.status === 'mal' ? 'fa fa-times-circle me-2' : 'fa fa-times me-2'"/>
                                                        <span t-if="state.currentItem.status === 'mal'">✓ SELECCIONADO - </span>Mal
                                                    </button>
                                                    <button t-att-class="state.currentItem.status === 'na' ? 'btn btn-secondary btn-lg fw-bold border-3 border-dark' : 'btn btn-outline-secondary btn-lg'"
                                                            t-on-click="() => this.onSelectStatus('na')">
                                                        <i t-att-class="state.currentItem.status === 'na' ? 'fa fa-minus-circle me-2' : 'fa fa-minus me-2'"/>
                                                        <span t-if="state.currentItem.status === 'na'">✓ SELECCIONADO - </span>No Aplica
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </t>
                                    <t t-else="">
                                        <div class="alert alert-info">
                                            No hay elementos para inspeccionar
                                        </div>
                                    </t>
                                </div>
                            </div>
                            
                            <!-- Navigation -->
                            <div class="row mt-3 flex-shrink-0">
                                <div class="col-6">
                                    <button class="btn btn-outline-secondary btn-block w-100" 
                                            t-att-disabled="state.itemIndex === 0"
                                            t-on-click="this.onPreviousItem">
                                        <i class="fa fa-arrow-left me-2"/>
                                        Anterior
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button class="btn btn-primary btn-block w-100" 
                                            t-on-click="this.onNextItem">
                                        <i class="fa fa-arrow-right me-2"/>
                                        <t t-if="state.itemIndex &lt; state.items.length - 1">Siguiente</t>
                                        <t t-else="">
                                            <t t-if="state.items.filter(item => !item.status).length > 0">
                                                Revisar (<t t-esc="state.items.filter(item => !item.status).length"/> pendientes)
                                            </t>
                                            <t t-else="">Finalizar</t>
                                        </t>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </t>
                    <t t-elif="state.showingSignature">
                        <!-- Digital Signature Screen -->
                        <div class="container-fluid h-100 d-flex flex-column">
                            <!-- Header -->
                            <div class="row bg-success text-white border-bottom py-2 mb-3 flex-shrink-0">
                                <div class="col-12">
                                    <h6 class="mb-1">
                                        <i class="fa fa-signature me-2"/>
                                        Firma del Conductor
                                    </h6>
                                    <small>
                                        Firme en el área gris para finalizar la inspección
                                    </small>
                                </div>
                            </div>
                            
                            <!-- Signature Area -->
                            <div class="row flex-grow-1">
                                <div class="col-12">
                                    <div class="card h-100">
                                        <div class="card-body d-flex flex-column">
                                            <p class="mb-3 text-center">
                                                <strong>Por favor firme aquí:</strong>
                                            </p>
                                            
                                            <!-- Canvas for signature -->
                                            <div class="signature-container flex-grow-1 border border-secondary rounded p-2 mb-3" 
                                                 style="background-color: #f8f9fa; min-height: 200px; position: relative;">
                                                <canvas id="signatureCanvas" 
                                                        style="width: 100%; height: 100%; cursor: crosshair; touch-action: none;"
                                                        t-ref="signatureCanvas"></canvas>
                                                <div class="position-absolute top-50 start-50 translate-middle text-muted"
                                                     style="pointer-events: none; z-index: 0;">
                                                    Toque y arrastre para firmar
                                                </div>
                                            </div>
                                            
                                            <div class="text-center">
                                                <button class="btn btn-outline-secondary me-2" 
                                                        t-on-click="this.clearSignature">
                                                    <i class="fa fa-eraser me-2"/>
                                                    Limpiar
                                                </button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Actions -->
                            <div class="row mt-3 flex-shrink-0">
                                <div class="col-6">
                                    <button class="btn btn-outline-secondary btn-block w-100" 
                                            t-on-click="this.onSkipSignature">
                                        <i class="fa fa-forward me-2"/>
                                        Omitir Firma
                                    </button>
                                </div>
                                <div class="col-6">
                                    <button class="btn btn-success btn-block w-100" 
                                            t-on-click="this.onSaveSignature">
                                        <i class="fa fa-check me-2"/>
                                        Finalizar Inspección
                                    </button>
                                </div>
                            </div>
                        </div>
                    </t>
                    <t t-elif="state.inspectionCompleted">
                        <!-- Completion Screen -->
                        <div class="text-center py-5">
                            <div class="mb-4">
                                <i class="fa fa-check-circle fa-5x text-success"/>
                            </div>
                            <h3 class="mb-3">¡Inspección Completada!</h3>
                            <p class="text-muted mb-4">
                                Has completado <strong><t t-esc="state.completionStats.completed"/></strong> 
                                de <strong><t t-esc="state.completionStats.total"/></strong> elementos
                                (<t t-esc="state.completionStats.percentage"/>%)
                            </p>
                            <p class="text-info">
                                <i class="fa fa-spinner fa-spin me-2"/>
                                Volviendo al inicio en 2 segundos...
                            </p>
                            
                            <div class="d-grid gap-2 mx-auto" style="max-width: 300px;">
                                <button class="btn btn-primary btn-lg" t-on-click="() => this.resetToStartPage()">
                                    <i class="fa fa-plus me-2"/>
                                    Nueva Inspección Ahora
                                </button>
                            </div>
                        </div>
                    </t>
                    <t t-else="">
                        <div class="text-center py-5">
                            <h4 class="mb-4">Sistema de Inspección Vehicular</h4>
                            <p class="text-muted mb-4">
                                Seleccione una opción para comenzar
                            </p>
                            
                            <div class="d-grid gap-3 mx-auto" style="max-width: 300px;">
                                <button class="btn btn-primary btn-lg" t-on-click="onClickStart">
                                    <i class="fa fa-plus me-2"/>
                                    Nueva Inspección
                                </button>
                                
                                <button class="btn btn-outline-primary btn-lg" t-on-click="onClickResume">
                                    <i class="fa fa-play me-2"/>
                                    Continuar Inspección
                                </button>
                            </div>
                        </div>
                    </t>
                </div>
            </div>
        </div>
    </t>

</templates>